!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("zaza",["exports"],e):e(t.Zaza={})}(this,function(t){"use strict";var e={host:"https://files.zaza.rocks",adminHost:"https://files.zaza.rocks"},n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}u((r=r.apply(t,e||[])).next())})}function i(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var o=function(){function t(t){this.token=t}return t.prototype.do=function(t,e,n,o){return r(this,void 0,void 0,function(){var r,s,a;return i(this,function(i){switch(i.label){case 0:return this.token&&!o&&((r=new Headers(e.headers)).append("Authorization","Bearer "+this.token),e.headers=r),[4,fetch(new Request(t,e))];case 1:if(!(s=i.sent()).ok)return[2,[{},new Error("request failed: "+s.statusText)]];if(n)return s.body?[2,[s.body,null]]:[2,[{},null]];i.label=2;case 2:return i.trys.push([2,4,,5]),[4,s.json()];case 3:return[2,[i.sent(),null]];case 4:return a=i.sent(),[2,[{},new Error("failed to parse response: "+a)]];case 5:return[2]}})})},t.prototype.get=function(t,e,n){return r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return e||(e={}),e.method="GET",[4,this.do(t,e,!1,n)];case 1:return[2,r.sent()]}})})},t.prototype.put=function(t,e,n,o){return r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return n||(n={}),n.method="PUT",!n.body&&e&&(n.body=JSON.stringify(e)),[4,this.do(t,n,!1,o)];case 1:return[2,r.sent()]}})})},t.prototype.delete=function(t,e,n){return r(this,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return n||(n={}),n.method="delete",!n.body&&e&&(n.body=JSON.stringify(e)),[4,this.do(t,n,!0)];case 1:return[2,r.sent()]}})})},t}();function s(t,n){return r(this,void 0,void 0,function(){var r,o,s,u,c;return i(this,function(i){switch(i.label){case 0:return r={type:"owner",data:void 0},o=e.host+"/api/v1/views",[4,t.put(o,r)];case 1:if(s=i.sent(),u=s[0],c=s[1])throw new Error("request failed: "+c);return[2,new a(u.id,{project:n,client:t,data:u})]}})})}var a=function(){function t(t,e){this.qid=t,this.project=null==e?void 0:e.project,this._client=null==e?void 0:e.client,this._data=null==e?void 0:e.data}return t.prototype.viewURL=function(){return e.host+"/api/v1/views/"+this.qid},t.prototype.client=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:return this._client||(this._client=new o),this._client.token?[3,2]:[4,this.data()];case 1:t=e.sent(),this.setToken(t.authToken),e.label=2;case 2:return[2,this._client]}})})},t.prototype.data=function(){return r(this,void 0,void 0,function(){var t,e,n,r,s;return i(this,function(i){switch(i.label){case 0:return(t=this._data)?[2,t]:((e=this._client)||(e=new o,this._client=e),[4,e.get(this.viewURL())]);case 1:if(n=i.sent(),r=n[0],s=n[1])throw new Error("failed to get view data: "+s);return this._data=r,[2,this._data]}})})},t.prototype.setToken=function(t){this._client||(this._client=new o),this._client.token=t},t.prototype.fileURL=function(t,n,o){return r(this,void 0,void 0,function(){var r;return i(this,function(i){return r=e.host+"/api/v1/views/"+this.qid+"/"+t,n&&(r+="/"+n),o&&(r+="/"+o),[2,r]})})},t.prototype.fileURLUpload=function(t,e,n){return r(this,void 0,void 0,function(){var r,o;return i(this,function(i){switch(i.label){case 0:return[4,this.data()];case 1:return r=i.sent(),[4,this.fileURL(t,e,n)];case 2:return o=i.sent(),r.uploadsession&&(o+="?uploadsession="+r.uploadsession),[2,o]}})})},t.prototype.upload=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,s,a,u,c,l,f,d;return i(this,function(i){switch(i.label){case 0:return n={mode:420,name:e||t.name,size:t.size},[4,this.fileURLUpload("files")];case 1:return r=i.sent(),[4,this.client()];case 2:return[4,(o=i.sent()).put(r,n)];case 3:if(s=i.sent(),a=s[0],u=s[1])throw new Error("failed to start upload: "+u);return[4,o.do(a.uploadUrl,{method:"PUT",body:t},!0,!0)];case 4:if(c=i.sent(),l=c[1])throw new Error("failed to upload: "+l);return[4,this.fileURLUpload("files",a.metafest.fileQid,"end")];case 5:return r=i.sent(),[4,o.do(r,{method:"PUT",body:"{}"},!0)];case 6:if(f=i.sent(),d=f[1])throw new Error("failed to end upload: "+d);return[2,{FileQid:a.metafest.fileQid,Name:a.metafest.fileName,Size:a.metafest.size,MTime:a.metafest.modTime,FileMode:a.metafest.fileMode.toString()}]}})})},t.prototype.uploadVirtual=function(t,e){return r(this,void 0,void 0,function(){var n,r,o,s;return i(this,function(i){switch(i.label){case 0:return n={mode:t.GetMode(),name:e,size:0,fileContent:t.GetDefinition()},[4,this.fileURLUpload("virtual")];case 1:return r=i.sent(),[4,this.client()];case 2:return[4,i.sent().put(r,n,{},!0)];case 3:if(o=i.sent(),s=o[1])throw new Error("failed to upload definition: "+s);return[2]}})})},t.prototype.download=function(t){return r(this,void 0,void 0,function(){var e,n,r,o;return i(this,function(i){switch(i.label){case 0:return[4,this.fileURL("web",t)];case 1:return e=i.sent(),[4,this.client()];case 2:return[4,i.sent().do(e,{method:"get",headers:{"Content-Type":"application/octet-stream"}},!0,!0)];case 3:if(n=i.sent(),r=n[0],o=n[1])throw new Error("failed to download: "+o);return[2,r]}})})},t.prototype.downloadJSON=function(t){return r(this,void 0,void 0,function(){var e,n,r,o;return i(this,function(i){switch(i.label){case 0:return[4,this.fileURL("web",t)];case 1:return e=i.sent(),[4,this.client()];case 2:return[4,i.sent().get(e,{headers:{"Content-Type":"application/json"}},!0)];case 3:if(n=i.sent(),r=n[0],o=n[1])throw new Error("failed to download JSON: "+o);return[2,r]}})})},t.prototype.delete=function(t){return r(this,void 0,void 0,function(){var e,n,r;return i(this,function(i){switch(i.label){case 0:return[4,this.fileURL("files")];case 1:return e=i.sent(),[4,this.client()];case 2:return[4,i.sent().delete(e,[t.FileQid.toString()])];case 3:if(n=i.sent(),r=n[1])throw new Error("failed to delete: "+r);return[2]}})})},t.prototype.deleteBag=function(){return r(this,void 0,void 0,function(){var t,e,n;return i(this,function(r){switch(r.label){case 0:return t=this.viewURL(),[4,this.client()];case 1:return[4,r.sent().delete(t,null)];case 2:if(e=r.sent(),n=e[1])throw new Error("failed to delete: "+n);return[2]}})})},t.prototype.getUserView=function(n){return r(this,void 0,void 0,function(){var r,o,s,a,u;return i(this,function(i){switch(i.label){case 0:return r=e.host+"/api/v1/views",o={type:"user",data:{ownerId:this.qid,rights:n,isCanocical:1}},[4,this.client()];case 1:return[4,i.sent().put(r,o)];case 2:if(s=i.sent(),a=s[0],u=s[1])throw new Error("failed to get view data: "+u);return[2,new t(a.id,{project:this.project,data:a})]}})})},t.prototype.list=function(t){return r(this,void 0,void 0,function(){var e,n,r,o;return i(this,function(i){switch(i.label){case 0:return[4,this.fileURL("folders",t)];case 1:return e=i.sent(),[4,this.client()];case 2:return[4,i.sent().get(e)];case 3:if(n=i.sent(),r=n[0],o=n[1])throw new Error("failed to list: "+o);return[2,r]}})})},t.prototype.seal=function(){return r(this,void 0,void 0,function(){var t,e,n;return i(this,function(r){switch(r.label){case 0:return[4,this.fileURL("seal")];case 1:return t=r.sent(),[4,this.client()];case 2:return[4,r.sent().put(t,{})];case 3:if(e=r.sent(),n=e[1])throw new Error("failed to seal: "+n);return[2]}})})},t.prototype.getMetadata=function(){return r(this,void 0,void 0,function(){var t,e,n,r;return i(this,function(i){switch(i.label){case 0:return[4,this.fileURL("data/metadata")];case 1:return t=i.sent(),[4,this.client()];case 2:return[4,i.sent().get(t)];case 3:if(e=i.sent(),n=e[0],r=e[1])throw new Error("failed to get metadata: "+r);return[2,n]}})})},t.prototype.setMetadata=function(t){return r(this,void 0,void 0,function(){var e,n,r,o;return i(this,function(i){switch(i.label){case 0:return[4,this.fileURL("data/metadata")];case 1:return e=i.sent(),[4,this.client()];case 2:return[4,i.sent().put(e,t,{headers:{"Content-Type":"application/json"}})];case 3:if(n=i.sent(),r=n[0],o=n[1])throw new Error("failed to put metadata: "+o);return[2,r]}})})},t}(),u=function(){function t(t){this.apiKey=t,this.client=new o(t)}return t.prototype.createBag=function(){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return[4,s(this.client,this)];case 1:return[2,t.sent()]}})})},t.prototype.getView=function(t){var e=new a(t);return e._project=this,e},t.prototype.getMetadata=function(){return r(this,void 0,void 0,function(){var t,n,r,o;return i(this,function(i){switch(i.label){case 0:return t=e.adminHost+"/data/metadata",[4,this.client.get(t)];case 1:if(n=i.sent(),r=n[0],o=n[1])throw new Error("failed to get metadata: "+o);return[2,r]}})})},t.prototype.setMetadata=function(t){return r(this,void 0,void 0,function(){var n,r,o,s;return i(this,function(i){switch(i.label){case 0:return n=e.adminHost+"/data/metadata",[4,this.client.put(n,t)];case 1:if(r=i.sent(),o=r[0],s=r[1])throw new Error("failed to get metadata: "+s);return[2,o]}})})},t}(),c=function(t){function e(e,n){var r=t.call(this,50)||this;return r.url=e,r.target="_blank",n&&(r.target=n),r}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e.prototype.GetDefinition=function(){return{specversion:"1.0",definition:{type:"web-link",data:{url:this.url,target:this.target}}}},e}(function(){function t(t){this.mode=t}return t.prototype.GetMode=function(){return this.mode},t}());t.setHost=function(t){e.host=t},t.setAdminHost=function(t){e.adminHost=t},t.Project=u,t.createBag=function(){return r(this,void 0,void 0,function(){return i(this,function(t){return[2,s(new o)]})})},t.View=a,t.Link=c,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=zaza.js.map
